<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileServer æµ‹è¯•é¡µé¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        error: '#ef4444',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-8 flex items-center justify-center">
                ğŸš€ <span class="ml-2">FileServer åŠŸèƒ½æµ‹è¯•</span>
            </h1>

            <!-- å¥åº·æ£€æŸ¥ -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">1. å¥åº·æ£€æŸ¥</h2>
                <button onclick="checkHealth()"
                        class="bg-primary hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                    æ£€æŸ¥æœåŠ¡çŠ¶æ€
                </button>
                <div id="healthResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>

            <!-- æ–‡ä»¶ä¸Šä¼  -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">2. æ–‡ä»¶ä¸Šä¼ </h2>
                <input type="file" id="fileInput" accept="*/*"
                       class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent">
                <button onclick="uploadFile()"
                        class="bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                    ä¸Šä¼ æ–‡ä»¶
                </button>
                <div id="uploadResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>

            <!-- å¤šæ–‡ä»¶ä¸Šä¼  -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">3. å¤šæ–‡ä»¶ä¸Šä¼ </h2>
                <input type="file" id="multiFileInput" multiple accept="*/*"
                       class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent">
                <button onclick="uploadMultipleFiles()"
                        class="bg-warning hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                    ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
                </button>
                <div id="multiUploadResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>

            <!-- æ–‡ä»¶æ“ä½œ -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">4. æ–‡ä»¶æ“ä½œ</h2>
                <input type="text" id="fileKeyInput" placeholder="è¾“å…¥æ–‡ä»¶Key (ä»ä¸Šä¼ ç»“æœä¸­è·å–)"
                       class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent">
                <div class="flex flex-wrap gap-2">
                    <button onclick="getFileInfo()"
                            class="bg-primary hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        è·å–æ–‡ä»¶ä¿¡æ¯
                    </button>
                    <button onclick="downloadFile()"
                            class="bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        ä¸‹è½½æ–‡ä»¶
                    </button>
                    <button onclick="previewFile()"
                            class="bg-warning hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        é¢„è§ˆæ–‡ä»¶
                    </button>
                    <button onclick="deleteFile()"
                            class="bg-error hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        åˆ é™¤æ–‡ä»¶
                    </button>
                </div>
                <div id="operationResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:9101';

        // å¥åº·æ£€æŸ¥
        async function checkHealth() {
            const resultDiv = document.getElementById('healthResult');
            try {
                const response = await fetch(`${baseUrl}/health`);
                const data = await response.json();
                resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                resultDiv.innerHTML = `âœ… æœåŠ¡çŠ¶æ€: ${data.result}<br>å“åº”ç : ${data.code}<br>æ¶ˆæ¯: ${data.message}`;
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `âŒ è¿æ¥å¤±è´¥: ${error.message}`;
            }
        }

        // å•æ–‡ä»¶ä¸Šä¼ 
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('uploadResult');

            if (!fileInput.files[0]) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = 'âŒ è¯·é€‰æ‹©æ–‡ä»¶';
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch(`${baseUrl}/file/uploadOne`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âœ… ä¸Šä¼ æˆåŠŸ!<br>æ–‡ä»¶Key: <strong class="font-mono bg-gray-200 px-2 py-1 rounded">${data.result}</strong><br>è¯·å¤åˆ¶æ­¤Keyç”¨äºåç»­æ“ä½œ`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âŒ ä¸Šä¼ å¤±è´¥: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`;
            }
        }

        // å¤šæ–‡ä»¶ä¸Šä¼ 
        async function uploadMultipleFiles() {
            const fileInput = document.getElementById('multiFileInput');
            const resultDiv = document.getElementById('multiUploadResult');

            if (!fileInput.files.length) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = 'âŒ è¯·é€‰æ‹©æ–‡ä»¶';
                return;
            }

            const formData = new FormData();
            for (let file of fileInput.files) {
                formData.append('files', file);
            }

            try {
                const response = await fetch(`${baseUrl}/file/uploadFileMore`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âœ… ä¸Šä¼ æˆåŠŸ!<br>æ–‡ä»¶Keys: <strong class="font-mono bg-gray-200 px-2 py-1 rounded">${JSON.stringify(data.result)}</strong>`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âŒ ä¸Šä¼ å¤±è´¥: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`;
            }
        }

        // è·å–æ–‡ä»¶ä¿¡æ¯
        async function getFileInfo() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥æ–‡ä»¶Key';
                return;
            }

            try {
                const response = await fetch(`${baseUrl}/file/getInfo?fileKey=${fileKey}`);
                const data = await response.json();

                if (data.success) {
                    const info = data.result;
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âœ… æ–‡ä»¶ä¿¡æ¯:<br>
                        <div class="mt-2 space-y-1">
                            <div><span class="font-semibold">UUID:</span> ${info.uuid}</div>
                            <div><span class="font-semibold">æ–‡ä»¶å:</span> ${info.fileName}</div>
                            <div><span class="font-semibold">å¤§å°:</span> ${info.size} bytes</div>
                            <div><span class="font-semibold">ç±»å‹:</span> ${info.contentType}</div>
                            <div><span class="font-semibold">åç¼€:</span> ${info.subfix}</div>
                            <div><span class="font-semibold">åˆ›å»ºæ—¶é—´:</span> ${info.createTime}</div>
                        </div>`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âŒ è·å–å¤±è´¥: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `âŒ è·å–å¤±è´¥: ${error.message}`;
            }
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥æ–‡ä»¶Key';
                return;
            }

            resultDiv.className = 'bg-blue-100 border border-blue-400 text-blue-700 p-3 rounded-lg';
            resultDiv.innerHTML = 'ğŸ“¥ æ­£åœ¨ä¸‹è½½...';

            window.open(`${baseUrl}/file/${fileKey}`, '_blank');
        }

        // é¢„è§ˆæ–‡ä»¶
        function previewFile() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥æ–‡ä»¶Key';
                return;
            }

            resultDiv.className = 'bg-blue-100 border border-blue-400 text-blue-700 p-3 rounded-lg';
            resultDiv.innerHTML = 'ğŸ‘ï¸ æ­£åœ¨é¢„è§ˆ...';

            window.open(`${baseUrl}/file/viewFile/${fileKey}`, '_blank');
        }

        // åˆ é™¤æ–‡ä»¶
        async function deleteFile() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥æ–‡ä»¶Key';
                return;
            }

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')) {
                return;
            }

            try {
                const formData = new FormData();
                formData.append('fileKey', fileKey);

                const response = await fetch(`${baseUrl}/file/delete`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âœ… åˆ é™¤æˆåŠŸ!`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `âŒ åˆ é™¤å¤±è´¥: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `âŒ åˆ é™¤å¤±è´¥: ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å¥åº·çŠ¶æ€
        window.onload = function() {
            checkHealth();
        };
    </script>
</body>
</html>
