<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileServer 测试页面</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        error: '#ef4444',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-8 flex items-center justify-center">
                🚀 <span class="ml-2">FileServer 功能测试</span>
            </h1>

            <!-- 健康检查 -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">1. 健康检查</h2>
                <button onclick="checkHealth()"
                        class="bg-primary hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                    检查服务状态
                </button>
                <div id="healthResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>

            <!-- 文件上传 -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">2. 文件上传</h2>
                <input type="file" id="fileInput" accept="*/*"
                       class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent">
                <button onclick="uploadFile()"
                        class="bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                    上传文件
                </button>
                <div id="uploadResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>

            <!-- 多文件上传 -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">3. 多文件上传</h2>
                <input type="file" id="multiFileInput" multiple accept="*/*"
                       class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent">
                <button onclick="uploadMultipleFiles()"
                        class="bg-warning hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                    上传多个文件
                </button>
                <div id="multiUploadResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>

            <!-- 文件操作 -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg bg-gray-50">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">4. 文件操作</h2>
                <input type="text" id="fileKeyInput" placeholder="输入文件Key (从上传结果中获取)"
                       class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent">
                <div class="flex flex-wrap gap-2">
                    <button onclick="getFileInfo()"
                            class="bg-primary hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        获取文件信息
                    </button>
                    <button onclick="downloadFile()"
                            class="bg-success hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        下载文件
                    </button>
                    <button onclick="previewFile()"
                            class="bg-warning hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        预览文件
                    </button>
                    <button onclick="deleteFile()"
                            class="bg-error hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        删除文件
                    </button>
                </div>
                <div id="operationResult" class="mt-4 p-3 rounded-lg min-h-[20px]"></div>
            </div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:9101';

        // 健康检查
        async function checkHealth() {
            const resultDiv = document.getElementById('healthResult');
            try {
                const response = await fetch(`${baseUrl}/health`);
                const data = await response.json();
                resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                resultDiv.innerHTML = `✅ 服务状态: ${data.result}<br>响应码: ${data.code}<br>消息: ${data.message}`;
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `❌ 连接失败: ${error.message}`;
            }
        }

        // 单文件上传
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('uploadResult');

            if (!fileInput.files[0]) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = '❌ 请选择文件';
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch(`${baseUrl}/file/uploadOne`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `✅ 上传成功!<br>文件Key: <strong class="font-mono bg-gray-200 px-2 py-1 rounded">${data.result}</strong><br>请复制此Key用于后续操作`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `❌ 上传失败: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `❌ 上传失败: ${error.message}`;
            }
        }

        // 多文件上传
        async function uploadMultipleFiles() {
            const fileInput = document.getElementById('multiFileInput');
            const resultDiv = document.getElementById('multiUploadResult');

            if (!fileInput.files.length) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = '❌ 请选择文件';
                return;
            }

            const formData = new FormData();
            for (let file of fileInput.files) {
                formData.append('files', file);
            }

            try {
                const response = await fetch(`${baseUrl}/file/uploadFileMore`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `✅ 上传成功!<br>文件Keys: <strong class="font-mono bg-gray-200 px-2 py-1 rounded">${JSON.stringify(data.result)}</strong>`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `❌ 上传失败: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `❌ 上传失败: ${error.message}`;
            }
        }

        // 获取文件信息
        async function getFileInfo() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = '❌ 请输入文件Key';
                return;
            }

            try {
                const response = await fetch(`${baseUrl}/file/getInfo?fileKey=${fileKey}`);
                const data = await response.json();

                if (data.success) {
                    const info = data.result;
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `✅ 文件信息:<br>
                        <div class="mt-2 space-y-1">
                            <div><span class="font-semibold">UUID:</span> ${info.uuid}</div>
                            <div><span class="font-semibold">文件名:</span> ${info.fileName}</div>
                            <div><span class="font-semibold">大小:</span> ${info.size} bytes</div>
                            <div><span class="font-semibold">类型:</span> ${info.contentType}</div>
                            <div><span class="font-semibold">后缀:</span> ${info.subfix}</div>
                            <div><span class="font-semibold">创建时间:</span> ${info.createTime}</div>
                        </div>`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `❌ 获取失败: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `❌ 获取失败: ${error.message}`;
            }
        }

        // 下载文件
        function downloadFile() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = '❌ 请输入文件Key';
                return;
            }

            resultDiv.className = 'bg-blue-100 border border-blue-400 text-blue-700 p-3 rounded-lg';
            resultDiv.innerHTML = '📥 正在下载...';

            window.open(`${baseUrl}/file/${fileKey}`, '_blank');
        }

        // 预览文件
        function previewFile() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = '❌ 请输入文件Key';
                return;
            }

            resultDiv.className = 'bg-blue-100 border border-blue-400 text-blue-700 p-3 rounded-lg';
            resultDiv.innerHTML = '👁️ 正在预览...';

            window.open(`${baseUrl}/file/viewFile/${fileKey}`, '_blank');
        }

        // 删除文件
        async function deleteFile() {
            const fileKey = document.getElementById('fileKeyInput').value;
            const resultDiv = document.getElementById('operationResult');

            if (!fileKey) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = '❌ 请输入文件Key';
                return;
            }

            if (!confirm('确定要删除这个文件吗？')) {
                return;
            }

            try {
                const formData = new FormData();
                formData.append('fileKey', fileKey);

                const response = await fetch(`${baseUrl}/file/delete`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    resultDiv.className = 'bg-green-100 border border-green-400 text-green-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `✅ 删除成功!`;
                } else {
                    resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                    resultDiv.innerHTML = `❌ 删除失败: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'bg-red-100 border border-red-400 text-red-700 p-3 rounded-lg';
                resultDiv.innerHTML = `❌ 删除失败: ${error.message}`;
            }
        }

        // 页面加载时自动检查健康状态
        window.onload = function() {
            checkHealth();
        };
    </script>
</body>
</html>
